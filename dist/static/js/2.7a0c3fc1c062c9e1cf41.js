webpackJsonp([2],{"0+DG":function(e,t){},"5qIP":function(e,t){},CtgW:function(e,t){},WKi5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("3cXf"),n=i.n(a),s=i("rVsN"),c=i.n(s),o=i("FrmM"),r=i("psq8"),d=i.n(r),f=i("HBrH"),l=i.n(f);function m(e,t){var i,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],s=void 0;if(t=t||a.length,e)for(s=0;s<e;s++)n[s]=a[0|Math.random()*t];else for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",s=0;s<36;s++)n[s]||(i=0|16*Math.random(),n[s]=a[19===s?3&i|8:i]);return n.join("")}var v=i("nf7S"),u=void 0,h=void 0,b={props:["contentForm"],data:function(){return{extractSourceProperDisabled:!0,labelPosition:"top",currentOcrName:"",step3SharedStore:v.a,sharedState:v.a.state}},name:"evidenceForm",computed:{},components:{},methods:{getExtractSourceTxt:function(){return""!==this.currentOcrName?this.currentOcrName:this.contentForm.evidenceExtractSource.length>0?this.contentForm.evidenceExtractSource[0].ocrFileName:""},getIconClassName:function(e){switch(e.indexOf(".")<0?e.toLowerCase():e.split(".")[1].toLowerCase()){case"pdf":return"#icon-pdfwenjian";case"docx":case"doc":return"#icon-wordwenjian";case"JPG":case"jpg":case"tif":case"png":default:return"#icon-tupianwenjian"}},switchToPdf:function(e){this.currentOcrName=e.ocrFileName,this.ee.emit("switchPdfByOcrfileIdEvent",e.ocrFileId)},cateBelongLabel:function(){var e=this,t=d.a.filter(this.contentForm.cateBelong,function(t){return t.sectionId===e.contentForm.cateBelongValue});return t.length?t[0].sectionName:this.contentForm.cateBelongValue},changeToEmptyCallbak:function(e){""===e.target.value&&(this.currentOcrName="",this.contentForm.evidenceExtractSource=[])},pasteCallback:function(e){if(e.stopPropagation(),h&&this.contentForm.factConfirmEvidenceId===this.step3SharedStore.state.currentEvidenceId){var t={ocrFileId:1*h.ocrFileId,ocrFileName:h.ocrFileName,originalFile:h.originalFile,originalCateType:h.originalCateType,originalType:h.originalType,pageDes:"",sourceSort:this.contentForm.evidenceExtractSource.length+1};d.a.findIndex(this.contentForm.evidenceExtractSource,function(e){return e.ocrFileName===h.ocrFileName&&e.originalCateType===h.originalCateType&&e.originalType===h.originalType})<0&&this.contentForm.evidenceExtractSource.unshift(t),this.contentForm.evidenceExtractSource.length>1&&(this.extractSourceProperDisabled=!1)}}},created:function(){var e=this;window.eventEmitter?this.ee=window.eventEmitter:this.ee=window.eventEmitter=new l.a,this.unwatchInCreated=this.$watch("contentForm",function(t){e.emitEventName="evidenceFormUpdate",e.emitEventData={evidenceApproveContent:t.evidenceVerification,evidenceExtractContent:t.evidenceExtract,evidenceExtractTitle:e.cateBelongLabel(),caseMgtFactConfirmEvidenceSourceVoList:d.a.clone(t.evidenceExtractSource),evidenceFixedClassifyId:e.contentForm.evidenceFixedClassifyId,evidenceFixedClassifyName:e.contentForm.evidenceFixedClassifyName,evidenceClassifySort:e.contentForm.evidenceClassifySort,evidenceSort:t.evidenceSort,factConfirmId:e.contentForm.factConfirmId,factConfirmEvidenceId:e.contentForm.factConfirmEvidenceId},e.ee.emit(e.emitEventName,e.emitEventData)},{deep:!0,immediate:!0}),this.debounceEmitter=d.a.debounce(function(){e.ee.emit(e.emitEventName,e.emitEventData)},0)},mounted:function(){var e=this;this.$refs.evidenceExtractInput.$el.addEventListener("input",this.changeToEmptyCallbak,!1),this.$refs.evidenceExtractInput.$el.addEventListener("paste",this.pasteCallback,!1),this.step3SharedStore.state.currentFactId===this.contentForm.factConfirmId&&this.step3SharedStore.state.currentEvidenceFixedClassifyId===this.contentForm.evidenceFixedClassifyId&&this.step3SharedStore.setCurrentEvidenceIdAction(this.contentForm.factConfirmEvidenceId),window.eventEmitter?this.ee=window.eventEmitter:this.ee=window.eventEmitter=new l.a,this.contentForm.evidenceExtractSource.length>1&&(this.extractSourceProperDisabled=!1),this.contentForm.cateBelong=this.step3SharedStore.evidenceTitleCacheMap[this.contentForm.evidenceFixedClassifyId],"function"==typeof this.unwatchInCreated&&this.unwatchInCreated(),this.unwatchInMounted=this.$watch("contentForm",function(t){e.emitEventName="evidenceFormUpdate",e.emitEventData={evidenceApproveContent:t.evidenceVerification,evidenceExtractContent:t.evidenceExtract,evidenceExtractTitle:e.cateBelongLabel(),caseMgtFactConfirmEvidenceSourceVoList:d.a.clone(t.evidenceExtractSource),evidenceFixedClassifyId:e.contentForm.evidenceFixedClassifyId,evidenceFixedClassifyName:e.contentForm.evidenceFixedClassifyName,evidenceClassifySort:e.contentForm.evidenceClassifySort,evidenceSort:t.evidenceSort,factConfirmId:e.contentForm.factConfirmId,factConfirmEvidenceId:e.contentForm.factConfirmEvidenceId},e.ee.emit(e.emitEventName,e.emitEventData)},{deep:!0,immediate:!0}),u=function(e){h=e},this.ee.addListener("getPdfNameFromCopyAction",u)},beforeDestroy:function(){this.$refs.evidenceExtractInput.$el.removeEventListener("paste",this.pasteCallback,!1),this.$refs.evidenceExtractInput.$el.removeEventListener("input",this.changeToEmptyCallbak,!1)},destroyed:function(){"function"==typeof this.unwatchInCreated&&this.unwatchInMounted(),"function"==typeof this.unwatchInMounted&&this.unwatchInMounted(),this.ee.removeListener("getPdfNameFromCopyAction",u)}},C={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"evidence-item-content-wrap"},[i("el-form",{ref:"form",attrs:{"label-position":e.labelPosition,model:e.contentForm,"label-width":"80px"}},[e.contentForm.cateBelong.length?i("el-form-item",{attrs:{label:"证据所属类型"}},[i("el-select",{attrs:{clearable:!0,filterable:"","allow-create":"","default-first-option":"",placeholder:""},model:{value:e.contentForm.cateBelongValue,callback:function(t){e.$set(e.contentForm,"cateBelongValue",t)},expression:"contentForm.cateBelongValue"}},e._l(e.contentForm.cateBelong,function(e){return i("el-option",{key:e.sectionSort,attrs:{label:e.sectionName,value:e.sectionId}})}))],1):e._e(),e._v(" "),i("div",{staticClass:"div-form-item"},[i("h3",{staticClass:"h3-title"},[e._v("\r\n            证据摘录\r\n            "),e.getExtractSourceTxt()?i("el-popover",{attrs:{placement:"bottom-end",trigger:"hover","visible-arrow":!1,"popper-class":"evidence-form-popper"}},[i("ul",{staticClass:"extract-source-list"},e._l(e.contentForm.evidenceExtractSource,function(t){return i("li",{key:t.index,ref:"list-item",refInFor:!0,on:{click:function(i){e.switchToPdf(t)}}},[i("svg",{staticClass:"icon",staticStyle:{"margin-right":"8px"},attrs:{"aria-hidden":"true"}},[i("use",{attrs:{"xlink:href":e.getIconClassName(t.originalFile)}})]),i("span",[e._v(e._s(t.ocrFileName))])])})),e._v(" "),i("span",{staticClass:"eidt-wrap",attrs:{slot:"reference"},slot:"reference"},[i("em",[e._v("摘录来源：")]),e._v(e._s(e.getExtractSourceTxt())+"\r\n                "),i("i",{staticClass:"iconfont",staticStyle:{"font-size":"30px"},attrs:{title:"展开"}},[e._v("")])])]):e._e()],1),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-input",{ref:"evidenceExtractInput",attrs:{type:"textarea",maxlength:"2048",rows:"15"},model:{value:e.contentForm.evidenceExtract,callback:function(t){e.$set(e.contentForm,"evidenceExtract",t)},expression:"contentForm.evidenceExtract"}})],1)],1),e._v(" "),i("div",{staticClass:"div-form-item"},[i("h3",{staticClass:"h3-title"},[e._v("\r\n            证实\r\n            "),i("br")]),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-input",{attrs:{type:"textarea",rows:"5",maxlength:"2048"},model:{value:e.contentForm.evidenceVerification,callback:function(t){e.$set(e.contentForm,"evidenceVerification",t)},expression:"contentForm.evidenceVerification"}})],1)],1)],1)],1)},staticRenderFns:[]};var E={props:["initEvidenceData","cateId","cateName","factConfirmId","sortNum"],data:function(){return{closable:!1,currentTabName:"1",labelPosition:"top",editableTabsList:[],step3SharedStore:v.a,sharedState:v.a.state}},name:"",computed:{},components:{EvidenceForm:i("C7Lr")(b,C,!1,function(e){i("5qIP"),i("0+DG")},"data-v-03b6ca2b",null).exports},methods:{validateEvidenceTabs:function(e){var t=[];return e.length>=1&&d.a.forEach(e,function(e,i){""===e.contentForm.evidenceVerification&&""===e.contentForm.evidenceExtract&&""===e.contentForm.cateBelongValue&&t.push(e.title)}),t},addEvidenceTab:function(){var e=this,t=this.validateEvidenceTabs(this.editableTabsList);if(t.length)return this.$message({showClose:!1,message:t.join(",")+"没有填写完,不能新建下一个证据！",type:"warning"}),!1;this.closable=!1,this.editableTabsList.length>0&&(this.closable=!0);var i=this.editableTabsList.length+1;i=0===this.editableTabsList.length?this.editableTabsList.length+1:1*d.a.maxBy(this.editableTabsList,function(e){return 1*e.name}).name+1;var a="E"+m(8,16);this.editableTabsList.push({title:"证据"+i,name:i+"",contentForm:{evidenceFixedClassifyId:this.cateId,evidenceClassifySort:this.sortNum,cateBelongValue:"",cateBelong:[],evidenceExtract:"",evidenceExtractSource:[],evidenceVerification:"",evidenceSort:i,evidenceFixedClassifyName:this.cateName,factConfirmId:this.factConfirmId,factConfirmEvidenceId:a}}),this.currentTabName=i+"",this.step3SharedStore.setCurrentEvidenceIdAction(a),d.a.forEach(this.editableTabsList,function(t,i){e.editableTabsList[i].title="证据"+(i+1)})},locateTab:function(e){var t=d.a.orderBy(this.initEvidenceData,[function(e){return 1*e.evidenceSort}],["asc"]),i=d.a.findIndex(t,function(t){return t.factConfirmEvidenceId===e});i>=0&&(this.currentTabName=t[i].evidenceSort+"",this.step3SharedStore.setCurrentEvidenceIdAction(e))},selectGrandTab:function(e){var t=this;this.currentTabName=e.name;var i=d.a.findIndex(this.editableTabsList,function(e){return e.name===t.currentTabName}),a=this.editableTabsList[i].contentForm.factConfirmEvidenceId;this.step3SharedStore.setCurrentEvidenceIdAction(a)},removeGrandTab:function(e){var t=this,i=this.editableTabsList;2===i.length&&(this.closable=!1);var a=this.currentTabName;a===e&&i.forEach(function(t,n){if(t.name===e){var s=i[n+1]||i[n-1];s&&(a=s.name)}}),this.currentTabName=a;var n=d.a.findIndex(this.editableTabsList,function(t){return t.name===e}),s=this.editableTabsList[n].contentForm.factConfirmEvidenceId;this.step3SharedStore.setCurrentEvidenceIdAction(s),this.ee.emit("deleteEvidenceTabEvent",{factConfirmId:this.factConfirmId,evidenceSort:this.editableTabsList[n].name,factConfirmEvidenceId:this.editableTabsList[n].contentForm.factConfirmEvidenceId,evidenceFixedClassifyId:this.cateId}),this.editableTabsList=i.filter(function(t){return t.name!==e}),d.a.forEach(this.editableTabsList,function(e,i){t.editableTabsList[i].title="证据"+(i+1)})}},destroyed:function(){this.unwatchInCreated&&this.unwatchInCreated(),this.unwatchInMounted&&this.unwatchInMounted()},created:function(){var e=this;this.unwatchInCreated=this.$watch("sharedState",function(t,i){var a=d.a.findIndex(e.editableTabsList,function(t){return t.name===e.currentTabName});e.editableTabsList[a]&&e.editableTabsList[a]&&t.currentFactId===e.editableTabsList[a].contentForm.factConfirmId&&t.currentEvidenceFixedClassifyId===e.editableTabsList[a].contentForm.evidenceFixedClassifyId&&(e.currentTabName=e.editableTabsList[a].name,e.step3SharedStore.setCurrentEvidenceIdAction(e.editableTabsList[a].contentForm.factConfirmEvidenceId))},{deep:!0,immediate:!0})},mounted:function(){var e=this;if(window.eventEmitter?this.ee=window.eventEmitter:this.ee=window.eventEmitter=new l.a,this.initEvidenceData&&this.initEvidenceData.length){this.editableTabsList=[];var t=[];this.initEvidenceData.length>1?this.closable=!0:this.closable=!1,d.a.forEach(this.initEvidenceData,function(i){t.push({title:"证据"+i.evidenceSort,name:i.evidenceSort+"",contentForm:{evidenceFixedClassifyId:i.evidenceFixedClassifyId,evidenceClassifySort:e.sortNum,cateBelongValue:i.evidenceExtractTitle,cateBelong:[],evidenceExtract:i.evidenceExtractContent,evidenceExtractSource:d.a.clone(i.caseMgtFactConfirmEvidenceSourceVoList),evidenceVerification:i.evidenceApproveContent,evidenceSort:i.evidenceSort,evidenceFixedClassifyName:i.evidenceFixedClassifyName,factConfirmId:e.factConfirmId,factConfirmEvidenceId:i.factConfirmEvidenceId}})}),this.editableTabsList=d.a.orderBy(t,[[function(e){return 1*e.name}],["asc"]]),this.currentTabName=this.editableTabsList[0].name+"","function"==typeof this.unwatchInCreated&&this.unwatchInCreated(),this.unwatchInMounted=this.$watch("sharedState",function(t,i){var a=d.a.findIndex(e.editableTabsList,function(t){return t.name===e.currentTabName});e.editableTabsList[a]&&t.currentFactId===e.editableTabsList[a].contentForm.factConfirmId&&t.currentEvidenceFixedClassifyId===e.editableTabsList[a].contentForm.evidenceFixedClassifyId&&(e.currentTabName=e.editableTabsList[a].name,e.step3SharedStore.setCurrentEvidenceIdAction(e.editableTabsList[a].contentForm.factConfirmEvidenceId))},{deep:!0,immediate:!0}),this.$nextTick(function(){e.$route.params.factConfirmEvidenceId&&e.$nextTick(function(){e.locateTab(e.$route.params.factConfirmEvidenceId)})})}else this.addEvidenceTab()}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-tabs",{ref:"evidenceTabDom",staticClass:"evidence-item-tabs-wrap",attrs:{closable:e.closable},on:{"tab-remove":e.removeGrandTab,"tab-click":e.selectGrandTab},model:{value:e.currentTabName,callback:function(t){e.currentTabName=t},expression:"currentTabName"}},e._l(e.editableTabsList,function(e){return i("el-tab-pane",{key:e.name,attrs:{label:e.title,name:e.name}},[i("evidence-form",{attrs:{contentForm:e.contentForm}})],1)})),e._v(" "),i("el-button",{staticClass:"addBtn",staticStyle:{right:"10px"},attrs:{type:"text"},on:{click:function(t){e.addEvidenceTab()}}},[i("i",{staticClass:"iconfont",staticStyle:{"font-size":"16px","font-weight":"bold",color:"#42a0f8"},attrs:{title:"新增证据"}},[e._v("")])])],1)},staticRenderFns:[]};var F=void 0,g={props:["initData"],data:function(){return{closable:!1,currentTabName:"1",tabPosition:"left",editableTabsList:[],step3SharedStore:v.a,sharedState:v.a.state}},name:"",computed:{},components:{EvidenceTabs:i("C7Lr")(E,p,!1,function(e){i("CtgW")},null,null).exports},destroyed:function(){this.unwatchInMounted(),this.ee.removeListener("evidenceFormUpdate",F)},mounted:function(){var e=this;window.eventEmitter?this.ee=window.eventEmitter:this.ee=window.eventEmitter=new l.a,this.$route.params.evidenceFixedClassifyId&&this.$nextTick(function(){e.locateTab(e.$route.params.evidenceFixedClassifyId)}),this.editableTabsList=[];var t=[];d.a.forEach(this.initData,function(i){var a=d.a.clone(i.caseMgtFactConfirmEvidenceVoList);t.push({title:i.evidenceFixedClassifyName,name:i.evidenceClassifySort+"",cateId:i.evidenceFixedClassifyId,cateName:i.evidenceFixedClassifyName,caseMgtFactConfirmEvidenceVoList:a,factConfirmId:i.factConfirmId,contentForm:{}}),e.editableTabsList=d.a.orderBy(t,[function(e){return 1*e.name}],["asc"])});var i=d.a.findIndex(this.editableTabsList,function(t){return t.name===e.currentTabName}),a=this.editableTabsList[i].cateId;this.step3SharedStore.setCurrentEvidenceFixedClassifyIdAction(a),this.unwatchInMounted=this.$watch("sharedState",function(t,i){var a=d.a.findIndex(e.editableTabsList,function(t){return t.name===e.currentTabName});t.currentFactId===e.editableTabsList[a].factConfirmId&&e.step3SharedStore.setCurrentEvidenceFixedClassifyIdAction(e.editableTabsList[a].cateId)},{immediate:!0}),F=function(t){var i=d.a.findIndex(e.editableTabsList,function(e){return e.cateId===t.evidenceFixedClassifyId&&e.factConfirmId===t.factConfirmId});if(e.$refs.triangleFlagDom&&e.$refs.triangleFlagDom[i])if(e.showTriangleFlag([t]))e.$refs.triangleFlagDom[i].querySelector("i").style.display="block";else{if(t.evidenceSort>1)return;e.$refs.triangleFlagDom[i].querySelector("i").style.display="none"}},this.ee.addListener("evidenceFormUpdate",F)},methods:{showTriangleFlag:function(e){var t=0;return e.length>=1&&(d.a.forEach(e,function(e,i){""===e.evidenceApproveContent&&""===e.evidenceExtractContent&&""===e.evidenceExtractTitle||t++}),t>=1)},locateTab:function(e){var t=d.a.orderBy(this.initData,[function(e){return 1*e.evidenceClassifySort}],["asc"]),i=d.a.findIndex(t,function(t){return t.evidenceFixedClassifyId===e});i>=0&&(this.currentTabName=i+1+"",this.step3SharedStore.setCurrentEvidenceFixedClassifyIdAction(e))},selectEvidenceCateTab:function(e){var t=this,i=d.a.findIndex(this.editableTabsList,function(e){return e.name===t.currentTabName}),a=this.editableTabsList[i].cateId;this.currentTabName=e.name,this.step3SharedStore.setCurrentEvidenceFixedClassifyIdAction(a)}}},I={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"evidence-tabs-wrap"},[i("el-tabs",{attrs:{"tab-position":e.tabPosition,type:"card"},on:{"tab-click":e.selectEvidenceCateTab},model:{value:e.currentTabName,callback:function(t){e.currentTabName=t},expression:"currentTabName"}},e._l(e.editableTabsList,function(t){return i("el-tab-pane",{key:t.index,attrs:{label:t.title,name:t.name}},[i("span",{ref:"triangleFlagDom",refInFor:!0,attrs:{slot:"label"},slot:"label"},[e._v(e._s(t.title)),i("i",{directives:[{name:"show",rawName:"v-show",value:e.showTriangleFlag(t.caseMgtFactConfirmEvidenceVoList),expression:"showTriangleFlag(subItem.caseMgtFactConfirmEvidenceVoList)"}],staticClass:"sanjiao"})]),e._v(" "),i("evidence-tabs",{attrs:{initEvidenceData:t.caseMgtFactConfirmEvidenceVoList,sortNum:t.name,cateId:t.cateId,cateName:t.cateName,factConfirmId:t.factConfirmId}})],1)}))],1)},staticRenderFns:[]};var T=i("C7Lr")(g,I,!1,function(e){i("m1XG")},"data-v-17f22ce9",null).exports,S=[],L=void 0,x=void 0;function y(e,t){var i=!1;return d.a.forEach(e,function(e){e.factConfirmEvidenceId===t&&(i=!0)}),i}var w={name:"step3",props:{caseObj:{type:Object,required:!0}},components:{EvidenceCategoryTabs:T},mounted:function(){var e=this;window.checkIsSave=function(t,i){e.next(t,i)},window.eventEmitter?this.ee=window.eventEmitter:this.ee=window.eventEmitter=new l.a,this.$route.params.factConfirmId&&this.$route.params.ocrFileId&&(this.$nextTick(function(){e.locateTab(e.$route.params.factConfirmId)}),this.ee.emit("switchPdfByOcrfileIdEvent",this.$route.params.ocrFileId)),this.loading=!0,this.step3SharedStore.hasSaved?(this.loading=!1,this.getData(this.step3SharedStore.step3AllDatas),x=function(e){d.a.forEach(S,function(t){t.factConfirmId===e.factConfirmId&&d.a.forEach(t.caseMgtEvidenceClassifyVoList,function(t){t.evidenceFixedClassifyId===e.evidenceFixedClassifyId&&d.a.forEach(t.caseMgtFactConfirmEvidenceVoList,function(i,a){i&&i.factConfirmEvidenceId===e.factConfirmEvidenceId&&(t.caseMgtFactConfirmEvidenceVoList.splice(a,1),setTimeout(function(){d.a.forEach(S,function(e,t){d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e,t){d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e,t){e.evidenceSort=t+1})})})},0))})})})},this.ee.addListener("deleteEvidenceTabEvent",x),L=function(e){d.a.forEach(S,function(t){t.factConfirmId===e.factConfirmId&&d.a.forEach(t.caseMgtEvidenceClassifyVoList,function(t){t.evidenceFixedClassifyId===e.evidenceFixedClassifyId&&(y(t.caseMgtFactConfirmEvidenceVoList,e.factConfirmEvidenceId)?d.a.forEach(t.caseMgtFactConfirmEvidenceVoList,function(i,a){i.factConfirmEvidenceId===e.factConfirmEvidenceId&&d.a.assign(t.caseMgtFactConfirmEvidenceVoList[a],e)}):"caseMgtFactConfirmEvidenceVoList"in t&&d.a.isArray(t.caseMgtFactConfirmEvidenceVoList)?t.caseMgtFactConfirmEvidenceVoList.push(e):t.caseMgtFactConfirmEvidenceVoList=[e])})})},this.ee.addListener("evidenceFormUpdate",L)):this.resolveInitData().then(function(t){Object(o.j)({caseNumber:e.caseObj.caseNumber}).then(function(t){if("200"===t.data.code){if(t.data.data.caseMgtFactConfirmVoList&&0===t.data.data.caseMgtFactConfirmVoList.length)return e.closable=!1,e.addTab(),e.makeCaseMgtFactConfirmVoList(),void(e.loading=!1);t.data.data.caseMgtFactConfirmVoList&&t.data.data.caseMgtFactConfirmVoList.length>1&&(e.closable=!0),e.getData(t.data.data.caseMgtFactConfirmVoList),e.step3SharedStore.setHasSaved(!0),e.loading=!1}else t.data.msg?e.$message.error(t.data.msg):e.$message.error("数据出错！"),e.makeCaseMgtFactConfirmVoList(),e.addTab(),e.step3SharedStore.setHasSaved(!1),e.loading=!1}),x=function(e){d.a.forEach(S,function(t){t.factConfirmId===e.factConfirmId&&d.a.forEach(t.caseMgtEvidenceClassifyVoList,function(t){t.evidenceFixedClassifyId===e.evidenceFixedClassifyId&&d.a.forEach(t.caseMgtFactConfirmEvidenceVoList,function(i,a){i&&i.factConfirmEvidenceId===e.factConfirmEvidenceId&&(t.caseMgtFactConfirmEvidenceVoList.splice(a,1),setTimeout(function(){d.a.forEach(S,function(e,t){d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e,t){d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e,t){e.evidenceSort=t+1})})})},0))})})})},e.ee.addListener("deleteEvidenceTabEvent",x),L=function(e){d.a.forEach(S,function(t){t.factConfirmId===e.factConfirmId&&d.a.forEach(t.caseMgtEvidenceClassifyVoList,function(t){t.evidenceFixedClassifyId===e.evidenceFixedClassifyId&&(y(t.caseMgtFactConfirmEvidenceVoList,e.factConfirmEvidenceId)?d.a.forEach(t.caseMgtFactConfirmEvidenceVoList,function(i,a){i.factConfirmEvidenceId===e.factConfirmEvidenceId&&d.a.assign(t.caseMgtFactConfirmEvidenceVoList[a],e)}):"caseMgtFactConfirmEvidenceVoList"in t&&d.a.isArray(t.caseMgtFactConfirmEvidenceVoList)?t.caseMgtFactConfirmEvidenceVoList.push(e):t.caseMgtFactConfirmEvidenceVoList=[e])})})},e.ee.addListener("evidenceFormUpdate",L)})},data:function(){return{msg:"step3",closable:!1,currentTabName:"1",labelPosition:"top",editableTabsList:[],step3SharedStore:v.a,loading:!1}},destroyed:function(){this.ee.removeListener("deleteEvidenceTabEvent",x),this.ee.removeListener("evidenceFormUpdate",L)},methods:{getData:function(e){var t=this;this.editableTabsList=[],d.a.forEach(e,function(e){var i=d.a.clone(e.caseMgtEvidenceClassifyVoList);d.a.forEach(i,function(e){e.caseMgtFactConfirmEvidenceVoList||(e.caseMgtFactConfirmEvidenceVoList=[{caseMgtFactConfirmEvidenceSourceVoList:[],evidenceApproveContent:"",evidenceExtractContent:"",evidenceExtractTitle:"",evidenceFixedClassifyId:e.evidenceFixedClassifyId,evidenceFixedClassifyName:e.evidenceFixedClassifyName,evidenceSort:1,factConfirmEvidenceId:"E"+m(8,16),factConfirmId:e.factConfirmId}])}),t.editableTabsList.push({title:e.factFindingTitle,name:e.sort+"",caseMgtEvidenceClassifyVoList:i,factConfirmId:e.factConfirmId,contentForm:{basicInfo:e.factFindingContent}}),t.currentTabName=t.editableTabsList[0].name+""}),this.editableTabsList.length>1&&(this.closable=!0),this.makeCaseMgtFactConfirmVoList(),this.timer=setInterval(function(){if(t.editableTabsList[1*t.currentTabName-1]){clearInterval(t.timer);var e=t.editableTabsList[1*t.currentTabName-1].factConfirmId;t.step3SharedStore.setCurrentFactIdAction(e)}},100)},resolveInitData:function(){var e=this;return new c.a(function(t,i){Object(o.g)().then(function(a){if("200"===a.data.code){var n=[],s=[];d.a.forEach(a.data.data,function(t){var i={};i.evidenceClassifySort=t.sort,i.evidenceFixedClassifyId=t.classifyId,i.evidenceFixedClassifyName=t.classifyName,n.push(i),s.push(new c.a(function(i,a){Object(o.i)({evidenceFixedClassifyId:t.classifyId}).then(function(n){"200"===n.data.code?(i(n.data.data),e.step3SharedStore.setEvidenceTitleCacheMapByKey(t.classifyId,n.data.data)):a(n.data.msg)})}))}),c.a.all(s).then(function(e){t(e)}),e.step3SharedStore.setCaseMgtEvidenceClassifyVoList(n)}else i(a.data.msg)})})},handleInputChange:function(e){var t=this;d.a.forEach(S,function(i){i.sort===t.currentTabName&&(i.factFindingContent=e)})},makeCaseMgtFactConfirmVoList:function(){S=[],d.a.forEach(this.editableTabsList,function(e){var t={};t.factFindingContent=e.contentForm.basicInfo,t.factFindingTitle=e.title,t.factConfirmId=e.factConfirmId,t.sort=e.name,t.caseMgtEvidenceClassifyVoList=e.caseMgtEvidenceClassifyVoList,S.push(t)}),this.step3SharedStore.setStep3AllDatas(d.a.clone(S))},next:function(e,t){var i=this;this.compareSubmitDataWithInitData()?this.$confirm("有修改的事实认定未保存, 是否保存?","",{confirmButtonText:"保存",cancelButtonText:"取消",closeOnClickModal:!1,center:!0,showClose:!1}).then(function(){i.saveFactConfirmList(void 0,e,t)}).catch(function(){t?eDossier&&eDossier.close():e?i.$router.push({path:e}):(i.step3SharedStore.setHasSaved(!1),i.$router.push({name:"step4"}))}):t?eDossier&&eDossier.close():e?this.$router.push({path:e}):(this.step3SharedStore.setHasSaved(!0),this.$router.push({name:"step4"}))},prev:function(){var e=this;this.compareSubmitDataWithInitData()?this.$confirm("有修改的事实认定未保存, 是否保存?","",{confirmButtonText:"保存",cancelButtonText:"取消",closeOnClickModal:!1,center:!0,showClose:!1}).then(function(){e.saveFactConfirmList()}).catch(function(){e.step3SharedStore.setHasSaved(!1),e.$router.push({name:"step2"})}):(this.step3SharedStore.setHasSaved(!0),this.$router.push({name:"step2"}))},locateTab:function(e){var t=d.a.findIndex(this.step3SharedStore.step3AllDatas,function(t){return t.factConfirmId===e});t>=0&&(this.currentTabName=t+1+"",this.step3SharedStore.setCurrentFactIdAction(e))},selectTab:function(e){var t=d.a.findIndex(this.editableTabsList,function(t){return t.name===e.name}),i=this.editableTabsList[t].factConfirmId;this.currentTabName=e.name,this.step3SharedStore.setCurrentFactIdAction(i)},addTab:function(){var e=this;this.closable=!1,this.editableTabsList.length>0&&(this.closable=!0);var t="F"+m(8,16),i=[];d.a.forEach(this.step3SharedStore.caseMgtEvidenceClassifyVoList,function(e){var a={};a.evidenceClassifySort=e.evidenceClassifySort,a.evidenceFixedClassifyId=e.evidenceFixedClassifyId,a.evidenceFixedClassifyName=e.evidenceFixedClassifyName,a.factConfirmId=t,i.push(a)});var a=void 0;a=0===this.editableTabsList.length?this.editableTabsList.length+1:1*d.a.maxBy(this.editableTabsList,function(e){return 1*e.name}).name+1,this.editableTabsList.push({title:"事实"+a,name:a+"",caseMgtEvidenceClassifyVoList:i,factConfirmId:t,contentForm:{basicInfo:""}}),this.currentTabName=a+"";var n=d.a.findIndex(this.editableTabsList,function(e){return e.name===a+""}),s=d.a.clone(this.editableTabsList[n].caseMgtEvidenceClassifyVoList);d.a.forEach(s,function(e){e.caseMgtFactConfirmEvidenceVoList=[]}),S.push({caseMgtEvidenceClassifyVoList:s,factConfirmId:t,factFindingContent:"",factFindingTitle:"事实"+a,sort:a+""}),this.step3SharedStore.setCurrentFactIdAction(t),d.a.forEach(this.editableTabsList,function(t,i){e.editableTabsList[i].title="事实"+(i+1)}),d.a.forEach(S,function(e,t){e.factFindingTitle="事实"+(t+1)})},removeTab:function(e){var t=this,i=this.editableTabsList;2===i.length&&(this.closable=!1);var a=this.currentTabName;a===e&&i.forEach(function(t,n){if(t.name===e){var s=i[n+1]||i[n-1];s&&(a=s.name)}}),this.currentTabName=a;var n=d.a.findIndex(this.editableTabsList,function(e){return e.name===t.currentTabName}),s=this.editableTabsList[n].factConfirmId;this.step3SharedStore.setCurrentFactIdAction(s),this.editableTabsList=i.filter(function(t){return t.name!==e}),d.a.forEach(S,function(t,i){t&&t.sort===e&&S.splice(i,1)}),d.a.forEach(this.editableTabsList,function(e,i){t.editableTabsList[i].title="事实"+(i+1)}),d.a.forEach(S,function(e,t){e.factFindingTitle="事实"+(t+1)})},saveFactConfirmList:function(e,t,i){var a=this,n=d.a.cloneDeep(S);d.a.forEach(n,function(e){delete e.factConfirmId,d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e){delete e.factConfirmId,d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e){delete e.factConfirmId,delete e.factConfirmEvidenceId,delete e.evidenceClassifySort,e.caseMgtFactConfirmEvidenceSourceVoList=d.a.clone(e.caseMgtFactConfirmEvidenceSourceVoList)})})}),Object(o.r)({caseMgtFactConfirmVoList:n,caseNumber:this.caseObj.caseNumber}).then(function(n){if("200"===n.data.code){a.step3SharedStore.setHasSaved(!0);var s=d.a.clone(S);d.a.forEach(s,function(e,t){e.sort=t+1+"",d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e){d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e,t){e.evidenceSort=t+1})})}),a.step3SharedStore.setStep3AllDatas(s),e||a.$message({showClose:!1,message:"保存成功",type:"success"}),i?eDossier&&eDossier.close():t&&a.$router.push({path:t})}else n.data.msg?a.$message.error(n.data.msg):a.$message.error("数据出错！")})},clearConfirmList:function(){var e=this;Object(o.r)({caseMgtFactConfirmVoList:[],caseNumber:this.caseObj.caseNumber}).then(function(t){"200"===t.data.code?(e.step3SharedStore.setHasSaved(!0),S=[],e.step3SharedStore.setStep3AllDatas([]),e.editableTabsList=[],e.addTab(),e.$message({showClose:!1,message:"数据已清空",type:"success"})):t.data.msg?e.$message.error(t.data.msg):e.$message.error("数据出错！")})},compareSubmitDataWithInitData:function(){var e=d.a.clone(S);d.a.forEach(e,function(e,t){e.sort=t+1+"",d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e){d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e,t){e.evidenceSort=t+1})})}),d.a.forEach(e,function(e){d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e){d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e){delete e.evidenceClassifySort})})});var t=d.a.clone(this.step3SharedStore.step3AllDatas);d.a.forEach(t,function(e){d.a.forEach(e.caseMgtEvidenceClassifyVoList,function(e){d.a.forEach(e.caseMgtFactConfirmEvidenceVoList,function(e){delete e.evidenceClassifySort})})});var i=d.a.isEqual(JSON.parse(n()(t)),JSON.parse(n()(e)));return t.length&&0===t[0].caseMgtEvidenceClassifyVoList[0].caseMgtFactConfirmEvidenceVoList.length&&(i=!0),!i}}},N={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"step-wrap",attrs:{id:"step3"}},[i("el-tabs",{staticClass:"fact-tabs-wrap",attrs:{closable:e.closable},on:{"tab-remove":e.removeTab,"tab-click":e.selectTab},model:{value:e.currentTabName,callback:function(t){e.currentTabName=t},expression:"currentTabName"}},e._l(e.editableTabsList,function(t){return i("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[i("div",{staticClass:"step-body-wrap"},[i("el-form",{ref:"form",refInFor:!0,attrs:{"label-position":e.labelPosition,model:t.contentForm,"label-width":"80px"}},[i("el-row",[i("h3",{staticClass:"h3-title",staticStyle:{color:"#333","font-size":"14px","font-weight":"400","margin-bottom":"8px","line-height":"1em"}},[e._v("事实内容描述")]),e._v(" "),i("p",{staticStyle:{"margin-top":"8px","margin-bottom":"12px","line-height":"1em","font-size":"12px",color:"#999","font-weight":"400"}},[e._v("温馨提示：系统会自动获取事实信息，你也可以手动编辑")]),e._v(" "),i("el-form-item",{attrs:{label:""}},[i("el-input",{attrs:{type:"textarea",rows:"3",maxlength:"2048"},on:{change:e.handleInputChange},model:{value:t.contentForm.basicInfo,callback:function(i){e.$set(t.contentForm,"basicInfo",i)},expression:"item.contentForm.basicInfo"}})],1)],1),e._v(" "),i("el-row",[i("h3",{staticClass:"h3-title",staticStyle:{"font-size":"14px",color:"#333","font-weight":"400","line-height":"1em","margin-bottom":"12px"}},[e._v(e._s(t.title)+"的相关证据")]),e._v(" "),i("evidence-category-tabs",{attrs:{initData:t.caseMgtEvidenceClassifyVoList}})],1)],1)],1)])})),e._v(" "),i("el-button",{staticClass:"addBtn",attrs:{type:"text"},on:{click:function(t){e.addTab()}}},[i("i",{staticClass:"iconfont",staticStyle:{"font-size":"16px","font-weight":"bold",color:"#42a0f8"},attrs:{title:"新增事实"}},[e._v("")])]),e._v(" "),i("div",{staticClass:"step-footer-wrap"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.saveFactConfirmList(!1)}}},[e._v("保存")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.prev()}}},[e._v("上一步")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.next()}}},[e._v("下一步")])],1)],1)},staticRenderFns:[]};var M=i("C7Lr")(w,N,!1,function(e){i("miTS")},null,null);t.default=M.exports},m1XG:function(e,t){},miTS:function(e,t){}});
//# sourceMappingURL=2.7a0c3fc1c062c9e1cf41.js.map